<!DOCTYPE html>
<html>
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script type="module">
      import { postJSON, onStatus } from "./http.js";

      window.addEventListener( "load", () => {
        function signin(admin) {

          postJSON("/api/dashboard/signin", admin)
            .then((body) => {
              sessionStorage.setItem("user", JSON.stringify(body));
              window.location.replace("/dashboard/index.html");
            })
            .catch(
              onStatus(401, () => {
                alert("Signin required");
              })
            )
            .catch((err) => {
              // eslint-disable-next-line
              console.error(err);
              alert("Something went wrong!");
            });
        }

        const signinForm = document.getElementById("signin-form");
        signinForm.addEventListener("submit", (event) => {
          event.preventDefault();
          const formData = new FormData(event.target);
          const admin = Object.fromEntries(formData);
          console.log(admin);

          signin(admin);
        });
      });
    </script>

    <style>
      body {
        background-color: #f5f5f5 !important;
      }

      form {
        max-width: 330px;
        margin: auto;
      }

      .form-floating:focus-within {
        z-index: 2;
      }
    </style>
  </head>

  <body>
    <main class="w-100 h-100 container">
      <div class="row d-flex text-center align-items-center m-auto w-100 h-100">
        <div class="col m-auto">
          <img src="./assets/nolonoloplus-dark.png" alt="Nolo Nolo Plus Logo" />
          <h1 class="my-4 fw-normal">Dashboard</h1>

          <form id="signin-form" method="post">
            <div class="form-floating">
              <input
                id="email"
                type="email"
                name="email"
                autocomplete="email"
                placeholder="email@example.com"
                class="form-control rounded-0 rounded-top"
                required
              />
              <label for="email">Email</label>
            </div>
            <div class="form-floating">
              <input
                id="password"
                type="password"
                name="password"
                autocomplete="current-password"
                placeholder="Password"
                class="form-control rounded-0 rounded-bottom"
                minlength="4"
                required
              />
              <label for="password">Password</label>
            </div>

            <button class="btn btn-lg btn-danger w-100 mt-4" type="submit">
              Sign in
            </button>
          </form>
        </div>
      </div>
    </main>
  </body>
</html>
