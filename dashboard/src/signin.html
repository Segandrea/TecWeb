<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="icon" href="./assets/favicon.ico" />

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
      integrity="sha384-tKLJeE1ALTUwtXlaGjJYM3sejfssWdAaWR2s97axw4xkiAdMzQjtOjgcyw0Y50KU"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
      crossorigin="anonymous"
    ></script>
    <!-- Bootstrap -->

    <script type="module">
      import { postJSON, onStatus } from "./http.js";

      window.addEventListener("load", () => {
        function signin(admin) {
          postJSON("/api/dashboard/signin", admin)
            .then((body) => {
              sessionStorage.setItem("user", JSON.stringify(body));
              window.location.replace("/dashboard/index.html");
            })
            .catch(
              onStatus(401, () => {
                alert("Signin required");
              })
            )
            .catch((err) => {
              // eslint-disable-next-line
              console.error(err);
              alert("Something went wrong!");
            });
        }

        const signinForm = document.getElementById("signin-form");
        signinForm.addEventListener("submit", (event) => {
          event.preventDefault();
          const formData = new FormData(event.target);
          const admin = Object.fromEntries(formData);
          console.log(admin);

          signin(admin);
        });
      });
    </script>

    <style>
      body {
        background-color: #f5f5f5 !important;
      }

      form {
        max-width: 330px;
        margin: auto;
      }

      .form-floating:focus-within {
        z-index: 2;
      }
    </style>
  </head>
  <body>
    <noscript>
      <strong
        >We're sorry but Signin doesn't work properly without JavaScript
        enabled. Please enable it to continue.</strong
      >
    </noscript>

    <main class="w-100 h-100 container">
      <div class="row d-flex text-center align-items-center m-auto w-100 h-100">
        <div class="col m-auto">
          <img src="./assets/nolonoloplus-dark.png" alt="Nolo Nolo Plus Logo" />
          <h1 class="my-4 fw-normal">Dashboard</h1>

          <form id="signin-form" method="post">
            <div class="form-floating">
              <input
                id="email"
                type="email"
                name="email"
                autocomplete="email"
                placeholder="email@example.com"
                class="form-control rounded-0 rounded-top"
                required
              />
              <label for="email">Email</label>
            </div>
            <div class="form-floating">
              <input
                id="password"
                type="password"
                name="password"
                autocomplete="current-password"
                placeholder="Password"
                class="form-control rounded-0 rounded-bottom"
                minlength="4"
                required
              />
              <label for="password">Password</label>
            </div>

            <button class="btn btn-lg btn-danger w-100 mt-4" type="submit">
              Sign in
            </button>
          </form>
        </div>
      </div>
    </main>
  </body>
</html>
